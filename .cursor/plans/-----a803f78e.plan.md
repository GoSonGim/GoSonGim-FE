<!-- a803f78e-d0ee-45d2-bd89-b4f5d5c66636 c9144f5b-d082-42a0-8fa7-6e9d1ddd569a -->
# SVG Path Animation Plan

## Overview

Replace manual Bezier curve calculations with native SVG Path APIs to ensure the ball animation perfectly follows the graph.svg curve from Figma.

## Implementation Steps

### 1. Verify and Import graph.svg

- Locate `graph.svg` in `src/assets/svgs/talkingkit/` (or wherever uploaded)
- Import using SVGR: `import GraphSvg from '@/assets/svgs/talkingkit/graph.svg'`
- If file location differs, adjust import path accordingly
- Note: No `?react` query needed since vite.config.ts already has SVGR configured with `exportType: 'default'`

### 2. Update `useBreathingAnimation.ts`

**Remove**: All Bezier curve calculations (`getCubicBezierPoint`, `calculateBallPosition`)

**Add**: SVG path-based position calculation using:

- `SVGPathElement.getTotalLength()` - get total path length
- `SVGPathElement.getPointAtLength(distance)` - get exact coordinates at any point
- Create path reference using `useRef<SVGPathElement | null>`
- Calculate ball position based on progress: `getPointAtLength(totalLength * progress)`

**Key logic**:

```typescript
// Store path references
const bluePathRef = useRef<SVGPathElement | null>(null);
const redPathRef = useRef<SVGPathElement | null>(null);

// Calculate position using path API
const calculateBallPosition = (progress: number) => {
  if (progress <= 0.5 && bluePathRef.current) {
    const pathLength = bluePathRef.current.getTotalLength();
    const point = bluePathRef.current.getPointAtLength(pathLength * (progress * 2));
    return { x: point.x, y: point.y };
  } else if (redPathRef.current) {
    const pathLength = redPathRef.current.getTotalLength();
    const point = redPathRef.current.getPointAtLength(pathLength * ((progress - 0.5) * 2));
    return { x: point.x, y: point.y };
  }
  return { x: 47, y: 194 }; // fallback
};
```

### 3. Update `BreathingGraph.tsx`

**Replace**: Hardcoded SVG paths with actual `graph.svg` import

**Structure**:

- Render base graph SVG (black, always visible)
- Render blue highlight path for inhale phase (conditionally visible)
- Render red highlight path for exhale phase (conditionally visible)
- Attach refs to blue/red path elements for position calculation
- Pass refs back to hook via callback or context

**Approach**: Either:

- Extract path `d` attributes from graph.svg and render separately with refs
- Or clone graph.svg elements and apply different styles/visibility

### 4. Update `ProgressBar.tsx`

**Current issue**: Progress bar not constrained to page

**Fix**: Ensure parent container in `BreathingExercise.tsx` has `relative` positioning

- Progress bar should use `absolute bottom-0 left-0 w-full` within page container
- Already implemented, verify visibility with `h-[8px]` and `z-20`

### 5. Verify Animation Flow

- Ready state: Ball at starting position (first point of blue path)
- Inhale (0-5s): Ball moves along blue path, blue highlight visible
- Exhale (5-10s): Ball moves along red path, both blue and red highlights visible
- Complete: Ball disappears, show "GREAT!" screen
- Progress bar shows smooth 0-100% over 10 seconds

## Key Files to Modify

1. **`src/hooks/useBreathingAnimation.ts`** (lines 4-51)

   - Remove Bezier functions
   - Add SVG path refs and `getPointAtLength()` logic
   - Return path refs or accept callback to set them

2. **`src/components/talkingkit/BreathingGraph.tsx`** (lines 3-84)

   - Import and render actual `graph.svg`
   - Attach refs to blue/red path elements
   - Ensure paths match Figma design

3. **`src/pages/talkingkit/BreathingExercise.tsx`** (verify layout)

   - Confirm progress bar container has proper positioning

## Technical Notes

- SVG path API is browser-native, no additional libraries needed
- `getTotalLength()` and `getPointAtLength()` work on any SVG path element
- Refs must be attached after SVG renders, use `useEffect` if needed
- Progress bar `ease-linear` transition ensures smooth progress display

### To-dos

- [ ] Import graph.svg and extract path elements for base graph, blue highlight, and red highlight
- [ ] Replace Bezier calculations with SVG path APIs (getTotalLength, getPointAtLength) in useBreathingAnimation.ts
- [ ] Render actual graph.svg with refs attached to blue/red paths in BreathingGraph.tsx
- [ ] Pass SVG path refs from BreathingGraph to useBreathingAnimation for position calculation
- [ ] Ensure progress bar is visible within page boundaries and animates smoothly
- [ ] Test full animation cycle: ready -> inhale -> exhale -> complete with proper highlighting